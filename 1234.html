<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>위도 경도로 주소 변환</title>
</head>
<body>
<div id="result"></div>
<script>
// URL에서 쿼리 매개변수 가져오는 함수
function getQueryParam(param) {
    var urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// 네이버 지도 API를 비동기로 로드하는 함수
function loadNaverMapAPI(callback) {
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=y9n3b00wzy&submodules=geocoder';
    script.async = true;
    script.onload = callback;
    document.head.appendChild(script);
}

async function getAddressByCoordinates(lat, lng) {
    console.log('Getting address for coordinates:', lat, lng);
    const clientId = 'y9n3b00wzy';
    const clientSecret = 'lfH5x7yYiPEjtakpQNkTv2mzhMwMgYtAQFEQWRWY';
    const coords = `${lng},${lat}`; // API 요청의 좌표 형식: "경도,위도"
    const url = `https://naveropenapi.apigw.ntruss.com/map-reversegeocode/v2/gc?coords=${coords}&sourcecrs=epsg:4326&orders=addr,roadaddr&output=json`;

    console.log('Request URL:', url);

    try {
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'X-NCP-APIGW-API-KEY-ID': clientId,
                'X-NCP-APIGW-API-KEY': clientSecret
            }
        });

        if (!response.ok) {
            console.error('Error:', response.status, response.statusText);
            alert('Something went wrong! Status: ' + response.status);
            return;
        }

        const data = await response.json();
        console.log('Response Data:', data);

        if (data.results.length > 0) {
            const result = data.results[0];
            const address = result.region.area1.name + ' ' + result.region.area2.name + ' ' + result.region.area3.name;

            document.getElementById('result').innerHTML = `
                <p>위도, 경도: ${lat}, ${lng}</p>
                <p>주소: ${address}</p>
            `;
        } else {
            document.getElementById('result').innerHTML = `
                <p>위도, 경도: ${lat}, ${lng}</p>
                <p>주소를 찾을 수 없습니다.</p>
            `;
        }
    } catch (error) {
        console.error('Fetch Error:', error);
        alert('Fetch Error: ' + error.message);
    }
}

// 네이버 지도 API 스크립트가 로드된 후에 주소 변환 함수 호출
function onLoadNaverMaps() {
    const latitude = parseFloat(getQueryParam('lat'));
    const longitude = parseFloat(getQueryParam('lng'));

    if (!isNaN(latitude) && !isNaN(longitude)) {
        getAddressByCoordinates(latitude, longitude);
    } else {
        console.error('Invalid latitude or longitude:', latitude, longitude);
        alert('Invalid latitude or longitude!');
    }
}

// 네이버 지도 API 스크립트가 로드될 때까지 대기
loadNaverMapAPI(onLoadNaverMaps);
</script>
</body>
</html>

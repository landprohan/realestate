<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Reverse Geocoding Example</title>
</head>
<body>
<script>
// URL에서 쿼리 매개변수 가져오는 함수
function getQueryParam(param) {
    var urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

async function getAddressByCoordinates(lat, lng) {
    alert('2');
    const clientId = 'y9n3b00wzy';
    const clientSecret = 'lfH5x7yYiPEjtakpQNkTv2mzhMwMgYtAQFEQWRWY';
    const coords = `${lng},${lat}`; // API 요청의 좌표 형식: "경도,위도"
    console.log('Coordinates:', coords);

    try {
        const response = await fetch(`https://naveropenapi.apigw.ntruss.com/map-reversegeocode/v2/gc?coords=${coords}&sourcecrs=epsg:4326&orders=addr,roadaddr&output=json`, {
            headers: {
                'X-NCP-APIGW-API-KEY-ID': clientId,
                'X-NCP-APIGW-API-KEY': clientSecret,
            }
        });
        alert('3');
        
        if (!response.ok) {
            console.error('Error:', response.status, response.statusText);
            alert('Something went wrong! Status: ' + response.status);
            return;
        }

        const data = await response.json();
        console.log('Response Data:', data);

        const result = data.results[0];
        const address = result.region.area1.name + ' ' + result.region.area2.name + ' ' + result.region.area3.name;

        document.getElementById('result').innerHTML = `
            <p>위도, 경도: ${lat}, ${lng}</p>
            <p>주소: ${address}</p>
        `;
    } catch (error) {
        console.error('Fetch Error:', error);
        alert('Fetch Error: ' + error.message);
    }
}

// URL에서 위도와 경도 값 가져오기
const latitude = parseFloat(getQueryParam('lat'));
const longitude = parseFloat(getQueryParam('lng'));

// 유효한 위도와 경도 값이 있을 경우에만 주소 변환 함수 호출
if (!isNaN(latitude) && !isNaN(longitude)) {
    getAddressByCoordinates(latitude, longitude);
} else {
    console.error('Invalid latitude or longitude:', latitude, longitude);
    alert('Invalid latitude or longitude!');
}
</script>

<div id="result"></div>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reverse Geocoding Example</title>
    <script type="text/javascript">
        // 네이버 지도 API를 비동기로 로드
        function loadNaverMapAPI(callback) {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=y9n3b00wzy&submodules=geocoder';
            script.async = true;
            script.onload = callback;
            script.onerror = function() {
                console.error('Failed to load Naver Map API');
                alert('Failed to load Naver Map API');
            };
            document.head.appendChild(script);
        }
    </script>
</head>
<body>
<div id="result"></div>
<script>
// URL에서 쿼리 매개변수 가져오는 함수
function getQueryParam(param) {
    var urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function getAddressByCoordinates(lat, lng) {
    console.log('Getting address for coordinates:', lat, lng);

    if (!naver || !naver.maps || !naver.maps.Service || !naver.maps.Service.reverseGeocode) {
        console.error('Naver Map API is not properly loaded.');
        alert('Naver Map API is not properly loaded.');
        return;
    }

    naver.maps.Service.reverseGeocode({
        location: new naver.maps.LatLng(lat, lng),
    }, function(status, response) {
        if (status !== naver.maps.Service.Status.OK) {
            console.error('Geocoding error:', status, response);
            alert('Something went wrong! Status: ' + status);
            return;
        }

        var result = response.result, // 검색 결과의 컨테이너
            items = result.items; // 검색 결과의 배열

        if (items.length === 0) {
            console.warn('No address found for coordinates:', lat, lng);
            alert('No address found!');
            return;
        }

        // 주소 정보 출력
        console.log('위도, 경도:', lat, lng);
        console.log('지번 주소:', items[0].address);
        console.log('도로명 주소:', items[1] ? items[1].address : '없음');

        // 화면에 출력
        document.getElementById('result').innerHTML = 
            '<p>위도, 경도: ' + lat + ', ' + lng + '</p>' +
            '<p>지번 주소: ' + items[0].address + '</p>' +
            '<p>도로명 주소: ' + (items[1] ? items[1].address : '없음') + '</p>';
    });
}

function onLoadNaverMaps() {
    const latitude = parseFloat(getQueryParam('lat'));
    const longitude = parseFloat(getQueryParam('lng'));

    if (!isNaN(latitude) && !isNaN(longitude)) {
        getAddressByCoordinates(latitude, longitude);
    } else {
        console.error('Invalid latitude or longitude:', latitude, longitude);
        alert('Invalid latitude or longitude!');
    }
}

// 네이버 지도 API 스크립트가 로드된 후에 주소 변환 함수 호출
loadNaverMapAPI(onLoadNaverMaps);
</script>
</body>
</html>
